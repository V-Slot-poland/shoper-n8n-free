{
  "name": "Shoper - Daily Orders Report + AI (Auto)",
  "nodes": [
    {
      "parameters": {
        "content": "## Shoper - Daily Report + AI\n\nâ° Automatically at 23:58 every day\nðŸ“Š Sends report to Slack\nðŸ¤– AI analyzes today's orders\n\n**Features:**\n- Fetches today's orders from Shoper API\n- AI creates intelligent summary\n- Sends report to Slack\n\n**Manual run:**\n- Click 'Test workflow'\n- Or send message via Chat Trigger",
        "height": 400,
        "width": 450
      },
      "id": "sticky-note-1",
      "name": "Info",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [-112, 368]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 1,
              "triggerAtHour": 23,
              "triggerAtMinute": 58
            }
          ]
        }
      },
      "id": "schedule-trigger-1",
      "name": "Daily at 23:58",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [688, 300]
    },
    {
      "parameters": {},
      "id": "manual-trigger-1",
      "name": "When clicking 'Test workflow'",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [688, 450]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "chat-trigger-1",
      "name": "When chat message received",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [688, 608],
      "webhookId": "shoper-daily-orders"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=You are an e-commerce expert analyzing today's orders from Shoper.\n\nYou respond ONLY IN POLISH, professionally and concisely.\n\nYou have access to functions:\n- getDzisiejszeZamowienia() - fetches today's orders from Shoper and returns summary\n\nToday's date: {{ $now.format('yyyy-MM-dd') }}\n\nTask:\n1. Call getDzisiejszeZamowienia() function\n2. Analyze results\n3. Create professional summary containing:\n   - Overall day assessment ðŸ“Š\n   - Key metrics (number of orders, total value) ðŸ“ˆ\n   - Recommendations or notes ðŸ’¡\n\nUse emojis for better readability.\nBe specific and helpful.",
        "options": {
          "systemMessage": "You are an AI assistant for e-commerce. You analyze sales and give practical recommendations. You respond ONLY in Polish."
        }
      },
      "id": "ai-agent-1",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [1012, 450]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "builtInTools": {},
        "options": {
          "maxTokens": 800,
          "temperature": 0.7
        }
      },
      "id": "openai-model-1",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [1012, 626],
      "credentials": {
        "openAiApi": {
          "id": "YOUR_OPENAI_CREDENTIAL_ID",
          "name": "OpenAI account"
        }
      }
    },
    {
      "parameters": {
        "name": "getDzisiejszeZamowienia",
        "description": "Fetches today's orders from Shoper API. First gets access_token via /auth endpoint, then fetches orders. No parameters required. Returns: date, number of orders, total value, order details.",
        "jsCode": "// Get today's date in YYYY-MM-DD format (timezone-safe)\nconst today = new Date();\nconst dateStr = today.toISOString().split('T')[0];\n\n// Shoper API configuration - REPLACE WITH YOUR VALUES\nconst shopUrl = 'YOUR_SHOP.shoper.pl';\nconst username = 'YOUR_SHOPER_USERNAME';\nconst password = 'YOUR_SHOPER_PASSWORD';\n\n// Step 1: Get access_token from /auth endpoint\nconst authString = Buffer.from(username + ':' + password).toString('base64');\n\nconst authResponse = await this.helpers.httpRequest({\n  method: 'POST',\n  url: 'https://' + shopUrl + '/webapi/rest/auth',\n  headers: {\n    'Authorization': 'Basic ' + authString,\n    'Content-Type': 'application/json'\n  }\n});\n\nif (!authResponse.access_token) {\n  return 'Error: Could not get access token from Shoper API';\n}\n\nconst accessToken = authResponse.access_token;\n\n// Step 2: Call Shoper API to get recent orders (max 50 per page)\n// Note: Shoper API filters[date] doesn't work reliably, so we fetch recent orders\n// and filter them client-side by date\nconst options = {\n  method: 'GET',\n  url: 'https://' + shopUrl + '/webapi/rest/orders?limit=50&order=order_id+DESC',\n  headers: {\n    'Authorization': 'Bearer ' + accessToken,\n    'Content-Type': 'application/json'\n  }\n};\n\ntry {\n  const response = await this.helpers.httpRequest(options);\n  \n  // Get all orders and filter by today's date\n  const allOrders = response.list || [];\n  const orders = allOrders.filter(order => {\n    const orderDate = (order.date || '').substring(0, 10); // Extract YYYY-MM-DD\n    return orderDate === dateStr;\n  });\n  const count = orders.length;\n  \n  // Calculate total value and prepare order list\n  let totalValue = 0;\n  const ordersList = [];\n  let currency = 'PLN';\n  \n  for (let i = 0; i < Math.min(10, orders.length); i++) {\n    const order = orders[i];\n    \n    // Get order value (sum field contains total order value)\n    const orderValue = parseFloat(order.sum) || 0;\n    totalValue += orderValue;\n    \n    // Get currency from first order\n    if (i === 0 && order.currency_id) {\n      currency = order.currency_id;\n    }\n    \n    // Build order info\n    const customerName = order.billing_address ? \n      (order.billing_address.firstname + ' ' + order.billing_address.lastname) : \n      order.email;\n    \n    const statusEmoji = order.confirm ? ' âœ…' : ' â³';\n    \n    ordersList.push(\n      'Order #' + order.order_id + ': ' +\n      customerName + ', ' +\n      orderValue.toFixed(2) + ' ' + currency +\n      statusEmoji\n    );\n  }\n  \n  // Calculate remaining orders value\n  for (let i = 10; i < orders.length; i++) {\n    const order = orders[i];\n    const orderValue = parseFloat(order.sum) || 0;\n    totalValue += orderValue;\n  }\n  \n  // Build summary string\n  let result = 'TODAY\\'S ORDERS SUMMARY (SHOPER)\\n';\n  result += '================================\\n';\n  result += 'Date: ' + dateStr + '\\n';\n  result += 'Number of orders: ' + count + '\\n';\n  result += 'Total value: ' + totalValue.toFixed(2) + ' ' + currency + '\\n';\n  \n  if (count > 0) {\n    result += '\\nFirst orders:\\n';\n    result += ordersList.join('\\n');\n    \n    if (count > 10) {\n      result += '\\n\\n...and ' + (count - 10) + ' more orders.';\n    }\n  } else {\n    result += '\\nNo orders today.';\n  }\n  \n  return result;\n  \n} catch (error) {\n  return 'Error fetching Shoper orders: ' + error.message;\n}"
      },
      "id": "tool-code-1",
      "name": "getDzisiejszeZamowienia Tool",
      "type": "@n8n/n8n-nodes-langchain.toolCode",
      "typeVersion": 1.1,
      "position": [1412, 674]
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "YOUR_SLACK_CHANNEL_ID",
          "mode": "list"
        },
        "text": "=ðŸ“Š *DAILY SHOPER REPORT*\nðŸ“… Date: {{ $now.format('yyyy-MM-dd') }}\n\n{{ $json.output }}\n\n_Report generated automatically at 23:58_",
        "otherOptions": {}
      },
      "id": "slack-1",
      "name": "Send to Slack",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.2,
      "position": [1232, 450],
      "credentials": {
        "slackApi": {
          "id": "YOUR_SLACK_CREDENTIAL_ID",
          "name": "Slack account"
        }
      }
    }
  ],
  "connections": {
    "Daily at 23:58": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking 'Test workflow'": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Send to Slack",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "getDzisiejszeZamowienia Tool": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}
